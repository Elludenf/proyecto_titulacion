<?php
/* 
 * Generated by CRUDigniter v3.0 Beta 
 * www.crudigniter.com
 */
 
class Logged_action extends CI_Controller
{
    function __construct()
    {
        parent::__construct();
        $this->load->model('Logged_action_model');
    } 

    /*
     * Listing of logged_actions
     */
    function index()
    {
        if (isset($_SERVER['HTTP_REFERER'])) {

        $data['logged_actions'] = $this->Logged_action_model->get_all_logged_actions();

        $this->load->view('logged_action/index',$data);
        }  else{


            $this->load->view('templates/header');
            $this->load->view('templates/forbidden');
            $this->load->view('templates/footer');

        }
    }

    /*Listing details
     *
     */
    function detail($action_tstamp)
    {
        if (isset($_SERVER['HTTP_REFERER'])) {
        // check if the logged_action exists before trying to edit it
        $data['logged_action'] = $this->Logged_action_model->get_logged_action($action_tstamp);

        if(isset($data['logged_action']['action_tstamp']))
        {
            $this->load->library('form_validation');

            $this->form_validation->set_rules('schema_name','Schema Name','required');
            $this->form_validation->set_rules('TABLE_NAME','TABLE NAME','required');
            $this->form_validation->set_rules('action_tstamp','Action Tstamp','required');
            $this->form_validation->set_rules('action','Action','required');

            if($this->form_validation->run())
            {
                $params = array(
                    'schema_name' => $this->input->post('schema_name'),
                    'TABLE_NAME' => $this->input->post('TABLE_NAME'),
                    'user_name' => $this->input->post('user_name'),
                    'action' => $this->input->post('action'),
                    'original_data' => $this->input->post('original_data'),
                    'new_data' => $this->input->post('new_data'),
                    'query' => $this->input->post('query'),
                );

                $this->Logged_action_model->update_logged_action($action_tstamp,$params);
                redirect('logged_action/index');
            }
            else
            {
                $this->load->view('logged_action/detail',$data);
            }
        }
        else
            show_error('The logged_action you are trying to edit does not exist.');

        }  else{


            $this->load->view('templates/header');
            $this->load->view('templates/forbidden');
            $this->load->view('templates/footer');

        }
    }
}
